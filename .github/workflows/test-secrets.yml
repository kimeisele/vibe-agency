name: Test GitHub Secrets

on:
  push:
    branches: [ claude/create-gad-003-* ]
  workflow_dispatch:

jobs:
  test-secrets:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Test API Key Secret Access
        env:
          GOOGLE_SEARCH_API_KEY: ${{ secrets.GOOGLE_SEARCH_API_KEY }}
          GOOGLE_SEARCH_ENGINE_ID: ${{ secrets.GOOGLE_SEARCH_ENGINE_ID }}
        run: |
          echo "=== Testing GitHub Secrets Access ==="

          # Check if secrets are loaded
          if [ -z "$GOOGLE_SEARCH_API_KEY" ]; then
            echo "❌ ERROR: GOOGLE_SEARCH_API_KEY is not set!"
            exit 1
          fi

          if [ -z "$GOOGLE_SEARCH_ENGINE_ID" ]; then
            echo "❌ ERROR: GOOGLE_SEARCH_ENGINE_ID is not set!"
            exit 1
          fi

          # Show secret lengths (without revealing values)
          echo "✅ GOOGLE_SEARCH_API_KEY is set (length: ${#GOOGLE_SEARCH_API_KEY} chars)"
          echo "✅ GOOGLE_SEARCH_ENGINE_ID is set (value: $GOOGLE_SEARCH_ENGINE_ID)"

          echo ""
          echo "=== Secrets loaded successfully! ==="

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      - name: Install dependencies
        run: |
          pip install requests beautifulsoup4

      - name: Test Google Search API
        env:
          GOOGLE_SEARCH_API_KEY: ${{ secrets.GOOGLE_SEARCH_API_KEY }}
          GOOGLE_SEARCH_ENGINE_ID: ${{ secrets.GOOGLE_SEARCH_ENGINE_ID }}
        run: |
          echo "=== Testing Google Custom Search API ==="
          python agency_os/00_system/orchestrator/tools/google_search_client.py || {
            echo "❌ Google Search API test failed!"
            echo "This might be due to:"
            echo "  - Invalid API key"
            echo "  - API quota exceeded"
            echo "  - Network issues"
            exit 1
          }
          echo "✅ Google Search API test passed!"

      - name: Test Web Fetch Client
        run: |
          echo "=== Testing Web Fetch Client ==="
          python agency_os/00_system/orchestrator/tools/web_fetch_client.py || {
            echo "❌ Web Fetch Client test failed!"
            exit 1
          }
          echo "✅ Web Fetch Client test passed!"
