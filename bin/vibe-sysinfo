#!/bin/bash
# vibe-sysinfo: System Information Fetcher
#
# Part of OPERATION FIRST_CONTACT - First real deliverable of VIBE Agency.
#
# This wrapper ensures the script runs with the correct Python interpreter
# that has psutil and rich installed.

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
export VIBE_ROOT="$(dirname "$SCRIPT_DIR")"

uv run python3 -c "
import sys
import json
import os
from pathlib import Path

try:
    from rich.console import Console
    from rich.table import Table
    from rich.panel import Panel
except ImportError as e:
    print(f'Error: Required library not found: {e}')
    print('Install with: pip install rich')
    sys.exit(1)

# Add the project root to sys.path to import vibe_studio module
vibe_root = os.environ.get('VIBE_ROOT', os.getcwd())
sys.path.insert(0, str(Path(vibe_root) / 'apps'))

try:
    from vibe_studio.sysinfo import get_system_info
except ImportError as e:
    print(f'Error: Could not import vibe_studio.sysinfo: {e}', file=sys.stderr)
    print('Make sure you are running this from the project root.', file=sys.stderr)
    sys.exit(1)


def display_table(info: dict) -> None:
    '''Display system information in a beautiful table format.'''
    console = Console()

    # Main panel
    title = f'ðŸ–¥ï¸  SYSTEM INFO: {info[\"hostname\"]}'
    console.print(Panel(title, style='bold blue'))

    # OS Information
    os_table = Table(title='ðŸ“‹ System', show_header=False, box=None)
    os_table.add_row('OS', info['os'])
    console.print(os_table)

    # CPU Table
    cpu_table = Table(title='âš™ï¸  CPU', show_header=True)
    cpu_table.add_column('Property', style='cyan')
    cpu_table.add_column('Value', style='green')
    cpu_table.add_row('Physical Cores', str(info['cpu']['cores']))
    cpu_table.add_row('Logical Threads', str(info['cpu']['threads']))
    cpu_table.add_row('Frequency (MHz)', str(info['cpu']['frequency_mhz']))
    cpu_table.add_row('Usage', f\"{info['cpu']['usage_percent']}%\")
    console.print(cpu_table)

    # Memory Table
    mem_table = Table(title='ðŸ’¾ Memory', show_header=True)
    mem_table.add_column('Property', style='cyan')
    mem_table.add_column('Value', style='green')
    mem_table.add_row('Total', f\"{info['memory']['total_gb']} GB\")
    mem_table.add_row('Used', f\"{info['memory']['used_gb']} GB\")
    mem_table.add_row('Available', f\"{info['memory']['available_gb']} GB\")
    mem_table.add_row('Usage', f\"{info['memory']['percent']}%\")
    console.print(mem_table)

    # Disk Table
    disk_table = Table(title='ðŸ’¿ Disk', show_header=True)
    disk_table.add_column('Property', style='cyan')
    disk_table.add_column('Value', style='green')
    disk_table.add_row('Total', f\"{info['disk']['total_gb']} GB\")
    disk_table.add_row('Used', f\"{info['disk']['used_gb']} GB\")
    disk_table.add_row('Free', f\"{info['disk']['free_gb']} GB\")
    disk_table.add_row('Usage', f\"{info['disk']['percent']}%\")
    console.print(disk_table)

    # Uptime Table
    uptime_table = Table(title='â±ï¸  Uptime', show_header=False, box=None)
    uptime_str = f\"{info['uptime']['days']}d {info['uptime']['hours']}h {info['uptime']['minutes']}m\"
    uptime_table.add_row('System Running', uptime_str)
    console.print(uptime_table)


def display_json(info: dict) -> None:
    '''Display system information as JSON.'''
    print(json.dumps(info, indent=2))


def main():
    '''Main entry point.'''
    import argparse

    parser = argparse.ArgumentParser(
        description='Display beautiful system information',
        formatter_class=argparse.RawDescriptionHelpFormatter,
        epilog='''
Examples:
  bin/vibe-sysinfo           # Show formatted table
  bin/vibe-sysinfo --json    # Show JSON output
        ''',
    )

    parser.add_argument(
        '--json',
        action='store_true',
        help='Output as JSON instead of formatted table',
    )
    parser.add_argument(
        '--version',
        action='version',
        version='vibe-sysinfo 1.0.0',
    )

    args = parser.parse_args()

    # Gather info
    info = get_system_info()

    # Display
    if args.json:
        display_json(info)
    else:
        display_table(info)


if __name__ == '__main__':
    main()
" "$@"
